#!/bin/sh

DB_HOST=hwduz83g2a.ewrjuzaefq.tsdb.cloud.timescale.com
DB_PORT=33025

DUMP_FILE=/db/supabase-remote-schema-`date +%s`.sql
HOST_DIR=`pwd`/dumps

. `dirname $0`/library.sh

docker run \
        --rm -it \
        --network host \
        -v $HOST_DIR:/db public.ecr.aws/supabase/postgres:17.4.1.041 \
    pg_dump \
        --verbose \
        --host $DB_HOST \
        --port $DB_PORT \
        --dbname=tsdb \
        --username=tsdbadmin \
        --file=$DUMP_FILE \
        --schema=myenergy \
        --clean --if-exists --schema-only

echo "Dumped to $HOST_DIR/`basename $DUMP_FILE`"

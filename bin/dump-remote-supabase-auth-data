#!/bin/sh

DUMP_FILE=/db/supabase-remote-data-auth-`date +%s`.sql
HOST_DIR=`pwd`/dumps

docker run \
        --rm -it \
        --network host \
        -v $HOST_DIR:/db postgres:17-alpine \
    pg_dump \
        --verbose \
        --host aws-0-eu-west-2.pooler.supabase.com \
        --port 6543 \
        --dbname=postgres \
        --username=postgres.pqlwxerasppsyleweruk \
        --file=$DUMP_FILE \
        --schema=auth \
        --table=auth.audit_log_entries \
        --table=auth.identities \
        --table=auth.refresh_tokens   \
        --table=auth.sessions \
        --table=auth.users \
        --data-only

echo "Dumped to $HOST_DIR/`basename $DUMP_FILE`"
